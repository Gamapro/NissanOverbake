
@{
    ViewBag.Title = "OverbakeLogCharts";
    Layout = "~/Views/Shared/_Layout.cshtml";
    <script src="@Url.Content("~/Scripts/Charts.min.js")"></script>
}

<div class="container-fluid px-4">
    <h1 class="mt-4">Overbake Charts</h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item">OVERBAKE CONTROL</li>
        <li class="breadcrumb-item active">Charts</li>
    </ol>
    <div class="card mb-4">
        <div class="card-header">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <i class="fas fa-chart-area me-1"></i> Overbaked pieces by
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Select filter</a>
                    <ul class="dropdown-menu dropdown-menu-lg-start" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href="#">Week</a></li>
                        <li><hr class="dropdown-divider" /></li>
                        <li><a class="dropdown-item" href="#">Month</a></li>
                        <li><hr class="dropdown-divider" /></li>
                        <li><a class="dropdown-item" href="#">Year</a></li>
                    </ul>
                </li>
            </ul>
        </div>
        <div class="card-body"><canvas id="myAreaChart" width="100" height="30"></canvas></div>
        <div class="card-footer small text-muted">Updated yesterday at 11:59 PM</div>
    </div>
    <div class="row">
        <div class="col-lg-6">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-chart-bar me-1"></i>
                    Overbaked pieces by month
                </div>
                <div class="card-body"><canvas id="myBarChart" width="100" height="50"></canvas></div>
                <div class="card-footer small text-muted">Updated yesterday at 11:59 PM</div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-chart-pie me-1"></i>
                    Overbaked pieces by plc
                </div>
                <div class="card-body"><canvas id="myPieChart" width="100" height="50"></canvas></div>
                <div class="card-footer small text-muted">Updated yesterday at 11:59 PM</div>
            </div>
        </div>
    </div>
</div>

@Scripts.Render("~/bundles/jquery")

<script>

    Chart.defaults.global.defaultFontFamily = '-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif';
    Chart.defaults.global.defaultFontColor = '#292b2c';

    function formatDate(date){
        var dd = String(date.getDate()).padStart(2, '0');
        var mm = String(date.getMonth() + 1).padStart(2, '0'); //January is 0!
        var yyyy = date.getFullYear();
        return yyyy + '-' + mm + '-' + dd;
    }
    
    var currentDate = new Date();
    var tomorrow = new Date();
    tomorrow.setDate(currentDate.getDate() + 1);
    var yesterday = new Date();
    yesterday.setDate(currentDate.getDate() - 1);
    var lastWeek = new Date();
    lastWeek.setDate(currentDate.getDate() - 7);
    var lastMonth = new Date();
    lastMonth.setDate(currentDate.getDate() - 30);
    var lastYear = new Date();
    lastYear.setDate(currentDate.getDate() - 365);

    // format
    var currentDate = formatDate(currentDate);
    var tomorrow = formatDate(tomorrow);
    var yesterday = formatDate(yesterday);
    var lastWeek = formatDate(lastWeek);
    var lastMonth = formatDate(lastMonth);
    var lastYear = formatDate(lastYear);
    
    var ctx = document.getElementById("myAreaChart");

    /*
    var myLineChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ["Mar 1", "Mar 2", "Mar 3", "Mar 4", "Mar 5", "Mar 6", "Mar 7", "Mar 8", "Mar 9", "Mar 10", "Mar 11", "Mar 12", "Mar 13"],
            datasets: [{
                label: "Sessions",
                lineTension: 0.3,
                backgroundColor: "rgba(2,117,216,0.2)",
                borderColor: "rgba(2,117,216,1)",
                pointRadius: 5,
                pointBackgroundColor: "rgba(2,117,216,1)",
                pointBorderColor: "rgba(255,255,255,0.8)",
                pointHoverRadius: 5,
                pointHoverBackgroundColor: "rgba(2,117,216,1)",
                pointHitRadius: 50,
                pointBorderWidth: 2,
                data: [10, 30, 26, 18, 18, 28, 31, 33, 25, 29, 32, 31, 38],
            }],
        },
        options: {
            scales: {
                xAxes: [{
                    time: {
                        unit: 'date'
                    },
                    gridLines: {
                        display: false
                    },
                    ticks: {
                        maxTicksLimit: 7
                    }
                }],
                yAxes: [{
                    ticks: {
                        min: 0,
                        max: 50,
                        maxTicksLimit: 5
                    },
                    gridLines: {
                        color: "rgba(0, 0, 0, .125)",
                    }
                }],
            },
            legend: {
                display: false
            }
        }
    });*/

    var ctx = document.getElementById("myBarChart");
    var myLineChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ["January", "February", "March", "April", "May", "June"],
            datasets: [{
                label: "Revenue",
                backgroundColor: "rgba(2,117,216,1)",
                borderColor: "rgba(2,117,216,1)",
                data: [421, 531, 625, 784, 982, 484],
            }],
        },
        options: {
            scales: {
                xAxes: [{
                    time: {
                        unit: 'month'
                    },
                    gridLines: {
                        display: false
                    },
                    ticks: {
                        maxTicksLimit: 6
                    }
                }],
                yAxes: [{
                    ticks: {
                        min: 0,
                        max: 1000,
                        maxTicksLimit: 5
                    },
                    gridLines: {
                        display: true
                    }
                }],
            },
            legend: {
                display: false
            }
        }
    });

    // Pie Chart Example
    backgroundColors = ['#007bff', '#dc3545', '#ffc107', '#28a745', '#6610f2', '#e83e8c', '#fd7e14', '#20c997', '#17a2b8', '#6f42c1', '#343a40', '#6c757d', '#007bff', '#dc3545', '#ffc107', '#28a745',]
    
    jQuery.ajax({
        url: "@Url.Action("ListOverbakeLogsWithDateRange", "OverbakeLogs")",
        type: "GET",
        data: { fechaInicio: currentDate, fechaFin: tomorrow },
        datatype: "json",
        contentType: "application/json; charset=utf-8",
        success: function (data) {
            console.log(data);
            var plcIds = {}, color = 0, labels = [], dataset = [], backgroundColor = [];
            for (var i = 0; i < data['data'].length; i++) {
                var plcId = data['data'][i].PlcName;
                if (plcIds[plcId] == undefined) {
                    plcIds[plcId] = {
                        label: data['data'][i].PlcName,
                        data: 1,
                        backgroundColor: backgroundColors[color++]
                    };
                } else {
                    plcIds[plcId].data++;
                }
            }
            for (var key in plcIds) {
                labels.push(plcIds[key].label);
                dataset.push(plcIds[key].data);
                backgroundColor.push(plcIds[key].backgroundColor);
            }
            var ctx = document.getElementById("myPieChart");
            var myPieChart = new Chart(ctx, {
                type: 'pie',
                data: { labels: labels, datasets: [{ data: dataset, backgroundColor: backgroundColor }], },
            });
        },
        error: function (error) {
            console.log(error);
        }
    })
    
</script>

